# OpenVPN Server Configuration
# Integrated with OpenVPN Manager API client

# Server mode
mode server
tls-server

# Network binding
local 0.0.0.0
port 1194
proto udp
dev tun

# Network topology
topology subnet
server 10.8.0.0 255.255.255.0

# Push topology to clients
push "topology subnet"

# Certificates and keys
ca /etc/openvpn/pki/ca.crt
cert /etc/openvpn/pki/server.crt
key /etc/openvpn/pki/server.key
dh /etc/openvpn/pki/dh.pem
crl-verify /etc/openvpn/pki/crl.pem
tls-auth /etc/openvpn/pki/ta.key 0

# Encryption
cipher AES-256-GCM
data-ciphers AES-256-GCM:AES-128-GCM:CHACHA20-POLY1305
auth SHA256

# Compression (optional)
# compress lz4-v2
# push "compress lz4-v2"

# Keepalive
keepalive 10 120

# Privileges
user nobody
group nobody

# Persistence
persist-key
persist-tun

# Logging
status /var/log/openvpn/status.log
log-append /var/log/openvpn/openvpn.log
verb 3

# Management interface (optional)
management localhost 7505

# ============================================
# OpenVPN Manager API Integration
# ============================================

# Use username as common name (required for API integration)
username-as-common-name

# Authentication script
# Validates user credentials against the API
auth-user-pass-verify /usr/local/bin/openvpn-login via-file

# Client connect script
# Assigns static IP and pushes routes based on user's group membership
client-connect /usr/local/bin/openvpn-connect

# Client disconnect script
# Records session end time and traffic statistics
client-disconnect /usr/local/bin/openvpn-disconnect

# Enable script execution
script-security 2

# Disable renegotiation (prevents script re-execution)
reneg-sec 0

# Allow duplicate common names (if users can have multiple sessions)
# duplicate-cn
