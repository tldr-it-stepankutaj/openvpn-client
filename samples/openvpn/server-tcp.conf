# OpenVPN Server Configuration (TCP)
# For networks where UDP is blocked (e.g., corporate firewalls)
# Integrated with OpenVPN Manager API client

# Server mode
mode server
tls-server

# Network binding - TCP on port 443 (HTTPS port for firewall bypass)
local 0.0.0.0
port 443
proto tcp
dev tun

# Allow floating client IPs (useful for mobile clients)
float

# Network topology
topology subnet
server 10.8.0.0 255.255.255.0

# Push topology to clients
push "topology subnet"

# Certificates and keys
ca /etc/openvpn/pki/ca.crt
cert /etc/openvpn/pki/server.crt
key /etc/openvpn/pki/server.key
dh /etc/openvpn/pki/dh.pem
crl-verify /etc/openvpn/pki/crl.pem
tls-auth /etc/openvpn/pki/ta.key 0

# Encryption
cipher AES-256-GCM
data-ciphers AES-256-GCM:AES-128-GCM:CHACHA20-POLY1305
auth SHA256

# TCP optimizations
tcp-nodelay
sndbuf 0
rcvbuf 0

# Keepalive
keepalive 10 120

# Privileges
user nobody
group nobody

# Persistence
persist-key
persist-tun

# Logging
status /var/log/openvpn/status.log
log-append /var/log/openvpn/openvpn.log
verb 3

# Management interface (optional)
management localhost 7505

# ============================================
# OpenVPN Manager API Integration
# ============================================

# Use username as common name (required for API integration)
username-as-common-name

# Authentication script
auth-user-pass-verify /usr/local/bin/openvpn-login via-file

# Client connect script
client-connect /usr/local/bin/openvpn-connect

# Client disconnect script
client-disconnect /usr/local/bin/openvpn-disconnect

# Enable script execution
script-security 2

# Disable renegotiation
reneg-sec 0
